---
phase: 03-core-read-operations
plan: 01
type: tdd
wave: 1
depends_on: []
files_modified:
  - src/types/dto.ts
  - src/transformers/email.ts
  - src/transformers/mailbox.ts
  - src/transformers/__tests__/email.test.ts
  - src/transformers/__tests__/mailbox.test.ts
autonomous: true

must_haves:
  truths:
    - "JMAP Email objects transform to SimplifiedEmail DTOs"
    - "JMAP Mailbox objects transform to SimplifiedMailbox DTOs"
    - "JMAP keywords ($seen, $flagged, $draft) convert to boolean flags (isRead, isFlagged, isDraft)"
    - "mailboxIds object converts to string array"
  artifacts:
    - path: "src/types/dto.ts"
      provides: "SimplifiedEmail, SimplifiedMailbox, EmailAddress, MailboxRole interfaces"
      exports: ["SimplifiedEmail", "SimplifiedMailbox", "EmailAddress", "SimplifiedAttachment", "MailboxRole"]
    - path: "src/transformers/email.ts"
      provides: "Email transformation function"
      exports: ["transformEmail"]
    - path: "src/transformers/mailbox.ts"
      provides: "Mailbox transformation function"
      exports: ["transformMailbox"]
  key_links:
    - from: "src/transformers/email.ts"
      to: "src/types/dto.ts"
      via: "import SimplifiedEmail"
      pattern: "import.*SimplifiedEmail.*from.*dto"
    - from: "src/transformers/mailbox.ts"
      to: "src/types/dto.ts"
      via: "import SimplifiedMailbox"
      pattern: "import.*SimplifiedMailbox.*from.*dto"
---

<objective>
Implement DTO types and transformer functions for JMAP Email and Mailbox objects using TDD.

Purpose: Transformers convert verbose JMAP objects to simplified DTOs that AI assistants can easily understand. The $seen/$flagged/$draft keywords must become isRead/isFlagged/isDraft boolean flags (TRANS-03).

Output: Working transformers with comprehensive test coverage, types ready for MCP tool integration.
</objective>

<execution_context>
@/Users/mmaudet/.claude/get-shit-done/workflows/execute-plan.md
@/Users/mmaudet/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-core-read-operations/03-RESEARCH.md

# Existing codebase patterns
@src/types/jmap.ts
@src/errors.ts
</context>

<feature>
  <name>Email and Mailbox Transformers</name>
  <files>
    src/types/dto.ts
    src/transformers/email.ts
    src/transformers/mailbox.ts
    src/transformers/__tests__/email.test.ts
    src/transformers/__tests__/mailbox.test.ts
  </files>
  <behavior>
    Email transformation cases:
    - transformEmail({ id: 'e1', keywords: { '$seen': true } }) -> { id: 'e1', isRead: true, isFlagged: false, isDraft: false }
    - transformEmail({ mailboxIds: { 'mb1': true, 'mb2': true } }) -> { mailboxIds: ['mb1', 'mb2'] }
    - transformEmail({ keywords: {} }) -> { isRead: false, isFlagged: false, isDraft: false, isAnswered: false, isForwarded: false }
    - transformEmail({ keywords: { '$flagged': true, '$draft': true } }) -> { isFlagged: true, isDraft: true }

    Mailbox transformation cases:
    - transformMailbox({ id: 'm1', name: 'Inbox', role: 'inbox', totalEmails: 100 }) -> { id: 'm1', name: 'Inbox', role: 'inbox', totalEmails: 100 }
    - transformMailbox({ role: null }) -> { role: null }
  </behavior>
  <implementation>
    1. Create DTO interfaces in src/types/dto.ts following RFC 8621 structure
    2. Implement transformEmail() handling keyword mapping and mailboxIds conversion
    3. Implement transformMailbox() with straightforward property mapping
    4. Use defensive coding: handle missing keywords, empty arrays, null values
  </implementation>
</feature>

<verification>
```bash
# Run transformer tests
npm test -- --testPathPattern="transformers"

# Verify exports
npx tsc --noEmit
```
</verification>

<success_criteria>
- transformEmail() converts JMAP Email to SimplifiedEmail with correct boolean flags
- transformMailbox() converts JMAP Mailbox to SimplifiedMailbox
- $seen -> isRead, $flagged -> isFlagged, $draft -> isDraft, $answered -> isAnswered, $forwarded -> isForwarded
- mailboxIds object (Record<string, boolean>) converts to string[]
- All edge cases handled (missing keywords, null values)
- Tests pass with >90% coverage of transformer logic
</success_criteria>

<output>
After completion, create `.planning/phases/03-core-read-operations/03-01-SUMMARY.md`
</output>
